{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load humanize %}
{% load customer_permissions %}

{% block title %}{% trans 'Customer List' %}{% endblock %}
{% block content %}
<div x-data="{
        search: '',
        filteredCustomers: [],
        deleteModalId: null,
        deleteCustomer(id) { this.deleteModalId = null; },
        openDeleteModal(id) { this.deleteModalId = id; }
    }" class="pl-8 pr-8 space-y-6">
    <!-- Header -->
    <div class="bg-gray-25 pl-8 pr-8">
        <div class="flex justify-between items-center p-0">
            <div>
                <h2 class="text-md font-semibold text-gray-700">{% trans "Customer" %}</h2>
                <p class="text-gray-600 mt-0.5 text-sm">{% trans "Customer Management" %}</p>
            </div>
            {% if perms.customer.add_company %}
            <a href="{% url 'customer:customer_create' %}" class="inline-flex items-center space-x-2
                         bg-blue-700 text-white border border-gray-200 px-3 py-1.5 rounded-md hover:bg-blue-900 text-sm">
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span>{% trans "Add New Customer" %}</span>
            </a>
            {% endif %}
        </div>
    </div>

     <div class="bg-white rounded-xl border border-gray-200 p-2">
         <!-- Search -->
             <div class="bg-gray-25 p-6">
                 <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-2 items-center">
                     <div class="relative col-span-2">
                         <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" stroke-width="2"/><path d="M21 21l-4.35-4.35" stroke-width="2" stroke-linecap="round"/></svg>
                         <input type="text" name="search" value="{{ search_query }}" placeholder="{% trans 'Search by name, city, or core business...' %}" class="custom-input-search pl-10 w-full" autocomplete="off">
                     </div>
                     <div class="flex space-x-2 mt-2 md:mt-0">
                         <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-900 text-sm">{% trans 'Search' %}</button>
                         {% if search_query %}
                         <a href="?" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 text-sm">{% trans 'Clear' %}</a>
                         {% endif %}
                     </div>
                 </form>
             </div>
         <!-- Customers Table -->
         <div class="bg-white rounded-lg p-6">
             <div class="overflow-hidden border border-gray-100 rounded-t-xl ">
                 <table class="min-w-full border-separate border-spacing-0 rounded-t-lg">
                     <thead class="text-sm  tracking-wider text-gray-700 border-b border-gray-200">
                         <tr>
                             <th class="px-6 py-4 text-left border-b border-gray-200">{% trans "Name" %}</th>
                             <th class="px-6 py-4 text-left border-b border-gray-200">{% trans "Type" %}</th>
                             <th class="px-6 py-4 text-left border-b border-gray-200">{% trans "City" %}</th>
                             <th class="px-6 py-4 text-left border-b border-gray-200">{% trans "Core Business" %}</th>
                             <th class="px-6 py-4 text-left border-b border-gray-200">{% trans "Active" %}</th>
                             <th class="px-6 py-4 text-left border-b border-gray-200"></th>
                     </thead>
                     <tbody>
                         {% for company in items %}
                         <tr class="hover:bg-blue-50 transition">
                             <td class="px-6 py-3 border-b border-r border-gray-100 bg-white">
                                 <a href="{% url 'customer:customer_detail' company.id %}" class="inline-flex items-center group text-gray-700 hover:text-black text-sm ">
                                     <svg class="h-4 w-4 mr-2 text-blue-500 group-hover:text-blue-700 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M1.5 12s4-7 10.5-7 10.5 7 10.5 7-4 7-10.5 7S1.5 12 1.5 12z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                     {{ company.name }}
                                 </a>
                             </td>
                             <td class="px-6 py-3 border-b border-r border-gray-100 bg-white">
                                 <span class="inline-block rounded bg-blue-100 text-blue-800 px-2 py-0.5 text-xs font-semibold">{{ company.get_company_type_display }}</span>
                             </td>
                             <td class="px-6 py-3 border-b border-r border-gray-100 bg-white">
                                 <span class="inline-block rounded bg-gray-100 text-gray-700 px-2 py-0.5 text-xs">{{ company.address.first.city.name|default:"-" }}</span>
                             </td>
                             <td class="px-6 py-3 border-b border-r border-gray-100 bg-white">
                                 <span class="inline-block rounded bg-gray-50 text-gray-700 px-2 py-0.5 text-xs">{{ company.core_business.name|default:"-" }}</span>
                             </td>
                             <td class="px-6 py-3 border-b bg-white">
                                 {% if company.active %}
                                     <span class="inline-block bg-green-100 text-green-800 px-2 py-0.5 rounded text-xs font-semibold">{% trans "Active" %}</span>
                                 {% else %}
                                     <span class="inline-block bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-xs font-semibold">{% trans "Inactive" %}</span>
                                 {% endif %}
                             </td>
                             <td class="px-6 py-3 border-b bg-white text-right">
                                 {% if user|can_edit_customer:company %}
                                 <a href="{% url 'customer:customer_update' company.id %}" class="inline-flex items-center px-3 py-1.5 bg-blue-600 hover:bg-blue-800 text-white rounded text-xs font-semibold transition">
                                     <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536M9 13l6-6 3 3-6 6H9v-3z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                                     {% trans "Edit" %}
                                 </a>
                                 {% endif %}
                             </td>
                         </tr>
                         {% empty %}
                         <tr>
                             <td colspan="5" class="text-center py-8 text-gray-500">{% trans "no_data" %}</td>
                         </tr>
                         {% endfor %}
                     </tbody>
                 </table>
             </div>
         </div>
     </div>
    {% include 'partials/pagination.html' %}
</div>
{% endblock %}
