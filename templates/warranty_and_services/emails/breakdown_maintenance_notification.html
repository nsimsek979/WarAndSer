<html>
<head>
    <meta charset="UTF-8">
    <title>Breakdown Maintenance Report PDF</title>
    <style>
        body { font-family: Arial, sans-serif; font-size: 13px; color: #222; background: #f7fafc; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #e2e8f0; padding: 32px; }
        h1 { font-size: 2em; color: #dc2626; margin-bottom: 18px; }
        h2 { font-size: 1.3em; color: #7f1d1d; margin-bottom: 12px; border-bottom: 2px solid #fecaca; padding-bottom: 4px; }
        h3, h4 { color: #dc2626; margin-bottom: 8px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 18px; background: #fef2f2; border-radius: 6px; }
        th, td { border: 1px solid #fca5a5; padding: 7px 10px; text-align: left; }
        th { background: #fecaca; color: #7f1d1d; font-weight: bold; }
        .section { margin-bottom: 32px; padding: 18px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #dc2626; }
        .img-box { background: #fee2e2; padding: 8px; border-radius: 8px; display: inline-block; margin: 10px 0; }
        .badge { font-size: 11px; font-weight: bold; padding: 2px 8px; border-radius: 6px; }
        .badge-breakdown { background: #fee2e2; color: #991b1b; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .breakdown-alert { background: #fee2e2; color: #991b1b; padding: 12px; border-radius: 6px; margin-bottom: 18px; border-left: 4px solid #dc2626; }
        .highlight { background: #fef3c7; padding: 8px; border-radius: 4px; }
        .breakdown-category { background: #dc2626; color: white; padding: 8px 12px; border-radius: 6px; display: inline-block; margin-bottom: 10px; font-weight: bold; }
        .breakdown-reason { background: #7f1d1d; color: white; padding: 6px 10px; border-radius: 4px; display: inline-block; margin-bottom: 10px; }
        .quantity-badge { background: #3b82f6; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px; }
        .urgent-banner { background: linear-gradient(45deg, #dc2626, #b91c1c); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="urgent-banner">
            🚨 {% if language == 'tr' %}ARIZA BAKIMI RAPORU{% else %}BREAKDOWN MAINTENANCE REPORT{% endif %} 🚨
        </div>

        <h1>{% if language == 'tr' %}Arıza Bakım Raporu{% else %}Breakdown Maintenance Report{% endif %}</h1>
        
        <div class="breakdown-alert">
            <strong>🔧 {% if language == 'tr' %}Arıza bakımı başarıyla tamamlanmıştır.{% else %}Breakdown maintenance completed successfully.{% endif %}</strong>
        </div>

        <div class="section">
            <h2>🔧 {% if language == 'tr' %}Arıza Bilgileri{% else %}Breakdown Information{% endif %}</h2>
            
            {% if maintenance_record.category %}
            <div style="margin-bottom: 15px;">
                <strong>{% if language == 'tr' %}Arıza Kategorisi:{% else %}Breakdown Category:{% endif %}</strong><br>
                <span class="breakdown-category">{{ maintenance_record.category.name }}</span>
            </div>
            {% endif %}

            {% if maintenance_record.breakdown_reason_selected %}
            <div style="margin-bottom: 15px;">
                <strong>{% if language == 'tr' %}Arıza Nedeni:{% else %}Breakdown Reason:{% endif %}</strong><br>
                <span class="breakdown-reason">{{ maintenance_record.breakdown_reason_selected.name }}</span>
            </div>
            {% endif %}

            {% if maintenance_record.breakdown_reason %}
            <div style="margin-bottom: 15px;">
                <strong>{% if language == 'tr' %}Arıza Detayları:{% else %}Breakdown Details:{% endif %}</strong><br>
                <div class="highlight">{{ maintenance_record.breakdown_reason|linebreaks }}</div>
            </div>
            {% endif %}

            <table>
                <tr><th>{% if language == 'tr' %}Arıza Tarihi{% else %}Breakdown Date{% endif %}</th><td>{{ service_date_formatted }}</td></tr>
                <tr><th>{% if language == 'tr' %}Bakım Teknisyeni{% else %}Maintenance Technician{% endif %}</th><td>{{ maintenance_record.technician.get_full_name|default:maintenance_record.technician.username }}</td></tr>
                {% if maintenance_record.technician.company %}
                <tr><th>{% if language == 'tr' %}Servis Firması{% else %}Service Company{% endif %}</th><td>{{ maintenance_record.technician.company.name }}</td></tr>
                {% endif %}
                <tr><th>{% if language == 'tr' %}Bakım Türü{% else %}Maintenance Type{% endif %}</th><td><span class="badge badge-breakdown">🔧 {% if language == 'tr' %}Arıza Bakımı{% else %}Breakdown Maintenance{% endif %}</span></td></tr>
            </table>
        </div>

        <div class="section">
            <h2>🏭 {% if language == 'tr' %}Cihaz Bilgileri{% else %}Equipment Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Ürün{% else %}Product{% endif %}</th><td>{{ installation.inventory_item.name.name }}</td></tr>
                {% if installation.inventory_item.name.brand_name %}
                <tr><th>{% if language == 'tr' %}Marka{% else %}Brand{% endif %}</th><td>{{ installation.inventory_item.name.brand_name }}</td></tr>
                {% endif %}
                {% if installation.inventory_item.serial_no %}
                <tr><th>{% if language == 'tr' %}Seri No{% else %}Serial No{% endif %}</th><td>{{ installation.inventory_item.serial_no }}</td></tr>
                {% endif %}
                {% if installation.inventory_item.name.category %}
                <tr><th>{% if language == 'tr' %}Kategori{% else %}Category{% endif %}</th><td>{{ installation.inventory_item.name.category.name }}</td></tr>
                {% endif %}
                <tr><th>{% if language == 'tr' %}Kurulum Tarihi{% else %}Installation Date{% endif %}</th><td>{{ installation.setup_date|date:"d.m.Y" }}</td></tr>
                {% if installation.location_address %}
                <tr><th>{% if language == 'tr' %}Adres{% else %}Address{% endif %}</th><td>{{ installation.location_address }}</td></tr>
                {% endif %}
            </table>
        </div>

        <div class="section">
            <h2>🏢 {% if language == 'tr' %}Müşteri Bilgileri{% else %}Customer Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Firma Adı{% else %}Company Name{% endif %}</th><td>{{ customer.name }}</td></tr>
                {% if customer.email %}
                <tr><th>{% if language == 'tr' %}E-posta{% else %}Email{% endif %}</th><td>{{ customer.email }}</td></tr>
                {% endif %}
                {% if customer.telephone %}
                <tr><th>{% if language == 'tr' %}Telefon{% else %}Phone{% endif %}</th><td>{{ customer.telephone }}</td></tr>
                {% endif %}
                {% if customer.tax_number %}
                <tr><th>{% if language == 'tr' %}Vergi No{% else %}Tax Number{% endif %}</th><td>{{ customer.tax_number }}</td></tr>
                {% endif %}
            </table>
        </div>

        {% if service_forms %}
        <div class="section">
            <h2>📋 {% if language == 'tr' %}Yapılan Servis Formları{% else %}Completed Service Forms{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Form Adı{% else %}Form Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Durum{% else %}Status{% endif %}</th>
                </tr>
                {% for service_form in service_forms %}
                <tr>
                    <td>{{ service_form.service_form.name }}</td>
                    <td><span class="badge badge-success">✅ {% if language == 'tr' %}Tamamlandı{% else %}Completed{% endif %}</span></td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if spare_parts %}
        <div class="section">
            <h2>🔧 {% if language == 'tr' %}Kullanılan Yedek Parçalar{% else %}Used Spare Parts{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Parça Adı{% else %}Part Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Miktar{% else %}Quantity{% endif %}</th>
                    <th>{% if language == 'tr' %}Açıklama{% else %}Notes{% endif %}</th>
                </tr>
                {% for spare_part in spare_parts %}
                <tr>
                    <td>{{ spare_part.spare_part.name }}</td>
                    <td><span class="quantity-badge">{{ spare_part.quantity_used }}</span></td>
                    <td>{{ spare_part.notes|default:"-" }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if maintenance_record.notes %}
        <div class="section">
            <h2>📝 {% if language == 'tr' %}Bakım Notları{% else %}Maintenance Notes{% endif %}</h2>
            <div class="highlight">
                {{ maintenance_record.notes|linebreaks }}
            </div>
        </div>
        {% endif %}

        {% if photos %}
        <div class="section">
            <h2>📸 {% if language == 'tr' %}Bakım Fotoğrafları{% else %}Maintenance Photos{% endif %}</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                {% for photo in photos %}
                <div class="img-box">
                    <strong>{% if language == 'tr' %}Fotoğraf{% else %}Photo{% endif %} {{ forloop.counter }}</strong><br>
                    {% if photo.description %}
                    <em>{{ photo.description }}</em><br>
                    {% endif %}
                    <small>{{ photo.created_at|date:"d.m.Y H:i" }}</small>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if documents %}
        <div class="section">
            <h2>📄 {% if language == 'tr' %}Bakım Belgeleri{% else %}Maintenance Documents{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Belge Adı{% else %}Document Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Açıklama{% else %}Description{% endif %}</th>
                    <th>{% if language == 'tr' %}Tarih{% else %}Date{% endif %}</th>
                </tr>
                {% for document in documents %}
                <tr>
                    <td>{{ document.name }}</td>
                    <td>{{ document.description|default:"-" }}</td>
                    <td>{{ document.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        <div class="section">
            <h2>ℹ️ {% if language == 'tr' %}Rapor Bilgileri{% else %}Report Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Rapor Tarihi{% else %}Report Date{% endif %}</th><td>{{ current_date }}</td></tr>
                <tr><th>{% if language == 'tr' %}Sistem{% else %}System{% endif %}</th><td>Konnektom Garanti ve Servis Sistemi</td></tr>
            </table>
        </div>

        <!-- Contact Information Section -->
        <div class="section" style="background: #fee2e2; border: 2px solid #dc2626; text-align: center;">
            <h2 style="color: #dc2626; margin-bottom: 15px;">📞 {% if language == 'tr' %}ACİL İLETİŞİM{% else %}URGENT CONTACT{% endif %}</h2>
            <p style="margin-bottom: 10px; font-size: 14px; font-weight: bold;">
                {% if language == 'tr' %}
                    Arıza ile ilgili herhangi bir sorunuz için lütfen acilen bizimle iletişime geçin:
                {% else %}
                    For any questions regarding this breakdown, please contact us urgently:
                {% endif %}
            </p>
            
            {% if maintenance_record.technician.company %}
            <div style="background: #dc2626; color: white; padding: 12px; border-radius: 6px; margin-bottom: 10px; font-weight: bold;">
                {{ maintenance_record.technician.company.name }}
            </div>
            
            {% if maintenance_record.technician.company.email %}
            <p style="margin: 5px 0; font-size: 16px;">
                <strong>📧 E-mail:</strong> 
                <a href="mailto:{{ maintenance_record.technician.company.email }}" style="color: #dc2626; text-decoration: none;">
                    {{ maintenance_record.technician.company.email }}
                </a>
            </p>
            {% endif %}
            
            {% if maintenance_record.technician.company.telephone %}
            <p style="margin: 5px 0; font-size: 16px;">
                <strong>📞 {% if language == 'tr' %}ACİL HAT{% else %}EMERGENCY LINE{% endif %}:</strong> 
                <a href="tel:{{ maintenance_record.technician.company.telephone }}" style="color: #dc2626; text-decoration: none; font-weight: bold;">
                    {{ maintenance_record.technician.company.telephone }}
                </a>
            </p>
            {% endif %}
            {% endif %}
            
            <p style="margin-top: 15px; font-size: 12px; color: #666;">
                {% if language == 'tr' %}
                    Konnektom Garanti ve Servis Sistemi
                {% else %}
                    Konnektom Warranty and Service System
                {% endif %}
            </p>
        </div>
    </div>
</body>
</html>
