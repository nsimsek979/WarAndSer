<html>
<head>
    <meta charset="UTF-8">
    <title>Maintenance Report PDF</title>
    <style>
        body { font-family: Arial, sans-serif; font-size: 13px; color: #222; background: #f7fafc; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px #e2e8f0; padding: 32px; }
        h1 { font-size: 2em; color: #2d3748; margin-bottom: 18px; }
        h2 { font-size: 1.3em; color: #4a5568; margin-bottom: 12px; border-bottom: 2px solid #e2e8f0; padding-bottom: 4px; }
        h3, h4 { color: #2b6cb0; margin-bottom: 8px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 18px; background: #f8fafc; border-radius: 6px; }
        th, td { border: 1px solid #cbd5e1; padding: 7px 10px; text-align: left; }
        th { background: #e2e8f0; color: #2d3748; font-weight: bold; }
        .section { margin-bottom: 32px; padding: 18px; background: #f1f5f9; border-radius: 8px; }
        .img-box { background: #e0e7ff; padding: 8px; border-radius: 8px; display: inline-block; margin: 10px 0; }
        .badge { font-size: 11px; font-weight: bold; padding: 2px 8px; border-radius: 6px; }
        .badge-periodic { background: #d1fae5; color: #065f46; }
        .badge-breakdown { background: #fee2e2; color: #991b1b; }
        .success { background: #d1fae5; color: #065f46; padding: 12px; border-radius: 6px; margin-bottom: 18px; }
        .highlight { background: #fef3c7; padding: 8px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>{% if language == 'tr' %}Bakım Raporu{% else %}Maintenance Report{% endif %}</h1>
        
        <div class="success">
            <strong>{% if language == 'tr' %}✅ Bakım işlemi başarıyla tamamlanmıştır.{% else %}✅ Maintenance operation completed successfully.{% endif %}</strong>
        </div>

        <div class="section">
            <h2>{% if language == 'tr' %}Bakım Bilgileri{% else %}Maintenance Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Bakım Tarihi{% else %}Maintenance Date{% endif %}</th><td>{{ service_entry.service_date|date:"d.m.Y" }}</td></tr>
                <tr><th>{% if language == 'tr' %}Bakım Saati{% else %}Maintenance Time{% endif %}</th><td>{{ service_entry.service_time|time:"H:i" }}</td></tr>
                <tr><th>{% if language == 'tr' %}Bakım Türü{% else %}Maintenance Type{% endif %}</th><td><span class="badge badge-{{ service_entry.service_type }}">{{ service_entry.get_service_type_display }}</span></td></tr>
                <tr><th>{% if language == 'tr' %}Teknisyen{% else %}Technician{% endif %}</th><td>{{ technician.get_full_name|default:technician.username }}</td></tr>
                {% if technician.company %}
                <tr><th>{% if language == 'tr' %}Servis Firması{% else %}Service Company{% endif %}</th><td>{{ technician.company.name }}</td></tr>
                {% endif %}
            </table>
        </div>

        <div class="section">
            <h2>{% if language == 'tr' %}Cihaz Bilgileri{% else %}Equipment Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Ürün{% else %}Product{% endif %}</th><td>{{ installation.inventory_item.name.name }}</td></tr>
                {% if installation.inventory_item.name.brand_name %}
                <tr><th>{% if language == 'tr' %}Marka{% else %}Brand{% endif %}</th><td>{{ installation.inventory_item.name.brand_name }}</td></tr>
                {% endif %}
                {% if installation.inventory_item.serial_no %}
                <tr><th>{% if language == 'tr' %}Seri No{% else %}Serial No{% endif %}</th><td>{{ installation.inventory_item.serial_no }}</td></tr>
                {% endif %}
                {% if installation.inventory_item.name.category %}
                <tr><th>{% if language == 'tr' %}Kategori{% else %}Category{% endif %}</th><td>{{ installation.inventory_item.name.category.name }}</td></tr>
                {% endif %}
                <tr><th>{% if language == 'tr' %}Kurulum Tarihi{% else %}Installation Date{% endif %}</th><td>{{ installation.setup_date|date:"d.m.Y" }}</td></tr>
                {% if installation.location_address %}
                <tr><th>{% if language == 'tr' %}Adres{% else %}Address{% endif %}</th><td>{{ installation.location_address }}</td></tr>
                {% endif %}
            </table>
        </div>

        <div class="section">
            <h2>{% if language == 'tr' %}Müşteri Bilgileri{% else %}Customer Information{% endif %}</h2>
            <table>
                <tr><th>{% if language == 'tr' %}Firma Adı{% else %}Company Name{% endif %}</th><td>{{ customer.name }}</td></tr>
                {% if customer.email %}
                <tr><th>{% if language == 'tr' %}E-posta{% else %}Email{% endif %}</th><td>{{ customer.email }}</td></tr>
                {% endif %}
                {% if customer.telephone %}
                <tr><th>{% if language == 'tr' %}Telefon{% else %}Phone{% endif %}</th><td>{{ customer.telephone }}</td></tr>
                {% endif %}
                {% if customer.tax_number %}
                <tr><th>{% if language == 'tr' %}Vergi No{% else %}Tax Number{% endif %}</th><td>{{ customer.tax_number }}</td></tr>
                {% endif %}
            </table>
        </div>

        {% if changed_spare_parts %}
        <div class="section">
            <h2>{% if language == 'tr' %}Değiştirilen Yedek Parçalar{% else %}Replaced Spare Parts{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Parça Adı{% else %}Part Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Kısa Kod{% else %}Short Code{% endif %}</th>
                </tr>
                {% for spare_part in changed_spare_parts %}
                <tr>
                    <td>{{ spare_part.name }}</td>
                    <td>{{ spare_part.shortcode|default:"-" }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if checked_controls %}
        <div class="section">
            <h2>{% if language == 'tr' %}Yapılan Kontroller{% else %}Performed Controls{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Kontrol Adı{% else %}Control Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Durum{% else %}Status{% endif %}</th>
                </tr>
                {% for control in checked_controls %}
                <tr>
                    <td>{{ control.name }}</td>
                    <td><span class="badge badge-periodic">{% if language == 'tr' %}✓ Yapıldı{% else %}✓ Completed{% endif %}</span></td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if service_entry.notes %}
        <div class="section">
            <h2>{% if language == 'tr' %}Bakım Notları{% else %}Maintenance Notes{% endif %}</h2>
            <div class="highlight">
                {{ service_entry.notes|linebreaks }}
            </div>
        </div>
        {% endif %}

        {% if images %}
        <div class="section">
            <h2>{% if language == 'tr' %}Bakım Fotoğrafları{% else %}Maintenance Photos{% endif %}</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for image in images %}
                <div class="img-box">
                    <img src="{{ image.image.url }}" alt="{{ image.title }}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">
                    {% if image.title %}<p style="margin: 5px 0 0 0; font-size: 11px; color: #666;">{{ image.title }}</p>{% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if documents %}
        <div class="section">
            <h2>{% if language == 'tr' %}Bakım Belgeleri{% else %}Maintenance Documents{% endif %}</h2>
            <table>
                <tr>
                    <th>{% if language == 'tr' %}Belge Adı{% else %}Document Name{% endif %}</th>
                    <th>{% if language == 'tr' %}Yükleme Tarihi{% else %}Upload Date{% endif %}</th>
                </tr>
                {% for document in documents %}
                <tr>
                    <td>{{ document.title|default:document.document.name }}</td>
                    <td>{{ document.uploaded_at|date:"d.m.Y H:i" }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        <div class="section">
            <h2>{% if language == 'tr' %}Sonraki İşlemler{% else %}Next Actions{% endif %}</h2>
            <p>{% if language == 'tr' %}
                Bu bakım raporu otomatik olarak oluşturulmuştur. Herhangi bir sorunuz varsa lütfen teknisyen ile iletişime geçin.
            {% else %}
                This maintenance report has been generated automatically. If you have any questions, please contact the technician.
            {% endif %}</p>
            
            {% if technician.email %}
            <p><strong>{% if language == 'tr' %}Teknisyen İletişim{% else %}Technician Contact{% endif %}:</strong> {{ technician.email }}</p>
            {% endif %}
        </div>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #666; font-size: 11px;">
            <p>{% if language == 'tr' %}Bu rapor {{ service_entry.created_at|date:"d.m.Y H:i" }} tarihinde otomatik olarak oluşturulmuştur.{% else %}This report was automatically generated on {{ service_entry.created_at|date:"d.m.Y H:i" }}.{% endif %}</p>
        </div>
    </div>
</body>
</html>
